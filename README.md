[English](README.md) | [中文](README_zh.md)

# YTracing

YTracing is a high-performance C++ event tracing library, supporting performance analysis and visualization in multi-threaded and multi-process environments.

---

## Features

- Lightweight and low-overhead performance tracing  
- Supports multi-thread and multi-process event recording  
- Generates visualization data compatible with [Perfetto](https://perfetto.dev/)  
- Provides CLI tools for data processing and analysis  

---

## Installation

### Method 1: Install via apt

1. Add the PPA repository:
```bash
sudo add-apt-repository ppa:zhangxiaochuan/ytracing
sudo apt update
````

2. Install the development package (includes headers and libraries):

```bash
sudo apt install libytracing-dev
```

### Method 2: Build from source

1. Clone the repository:

```bash
git clone https://github.com/zhangxiaochuan/YTracing.git
cd YTracing
```

2. Build and install:

```bash
mkdir build && cd build
cmake ..
make -j$(nproc)
sudo make install
```

---

## Usage

### Enable tracing

Include the header file and use the following two methods to record tracing information:
```cpp
#include <YTracing/YTracing.h>

void my_function() {
    // Method 1: YTRACING_FUNCTION
    // Records the execution time of the entire function (scope is the whole function)
    YTRACING_FUNCTION();

    // Simulate code execution
    for (int i = 0; i < 1000000; ++i) {}

    {
        // Method 2: YTRACING_SCOPE("Custom Scope Name")
        // Records the execution time of a custom code block (scope is limited to the braces)
        YTRACING_SCOPE("Inner Loop Work");

        for (int j = 0; j < 500000; ++j) {}
    }
}
```
Difference:

* YTRACING_FUNCTION(): Automatically uses the function name as the event name and records the total execution time of the function.
* YTRACING_SCOPE("Name"): Uses a custom name to record the execution time of a specific code block, suitable for localized performance analysis inside functions.

Add the following definition in `CMakeLists.txt` to enable tracing and link YTracing lib:

```cmake
add_definitions(-DTRACING=1) # enable tracing. Remove this line to disable tracing

find_package(ytracing REQUIRED)
target_link_libraries(your_target PRIVATE ytracing)
```

### Trace Visualization with **YViewer**

To make it easier to analyze tracing data visually, **YTracing** provides the `YViewer` command-line tool to help you visualize your trace results:

1. After compilation, run your target program. A folder named `tracing_YYYYMMDD_HHMMSS` will be generated in the working directory, containing the raw trace data in `.raw` format.

2. **Use YViewer to convert the `.raw` file into Perfetto format**
   `YViewer` converts the `.raw` trace data generated by YTracing into a `trace.json` format compatible with Perfetto.

3. **View and analyze in the Perfetto UI**
   Open [Perfetto Web UI](https://ui.perfetto.dev) in your browser and load the generated `trace.json` file. You can:

    * Inspect the nesting of function calls and scopes, along with their execution times.
    * Zoom, pan, and filter traces by name or time range to precisely locate areas of interest.
    * Analyze concurrency, thread activities, and function execution timing in an intuitive timeline view.

4. **Recommended usage workflow**

   ```bash
   # 1. Run the instrumented program:
   ./your_target
   # This creates a `tracing_YYYYMMDD_HHMMSS` directory containing `.raw` files.

   # 2. Convert the trace data to JSON:
   YViewer tracing_YYYYMMDD_HHMMSS/
   # This will generate a `trace.json` file in the tracing_YYYYMMDD_HHMMSS directory.

   # 3. Open and visualize:
   Open [Perfetto UI](https://ui.perfetto.dev) in your browser → Click "Open trace file" → Select `trace.json`.
   ```

---

## License

MIT License
